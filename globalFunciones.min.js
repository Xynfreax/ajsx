'use strict';$$.require([],function(){if(undefined==window.$f)window.$f={};$f.isLogged=function(fyes,fno){var req={type:"query",content:"isLoged",params:{nickname:localStorage.actual_user}};$f.xhrPost(req,function(res){if(res!==null){var res_json=JSON.parse(res);if(res_json.cod==0&&res_json.isLoged==true)fyes();else fno()}else alert("Hubo un error: NULL")});var inicioErp=function(){}};$f.xhrPost=function(data,callbackExito,callbackError){var xhr=new XMLHttpRequest;var xResponse=null;xhr.withCredentials=
true;serverIP="localhost";xhr.addEventListener("load",function(){var state=this.readyState;var responseCode=xhr.status;console.log("request.onload called. readyState: "+state+"; status: "+responseCode);if(state==this.DONE&&responseCode==200){console.log("si entro");var xResponse="";if(data.content=="getReporte")xResponse=this.response;else xResponse=this.responseText;callbackExito(JSON.parse(xResponse))}else;});xhr.addEventListener("error",function(e){console.log("--Error en xhr");if(callbackError!==
undefined)callbackError(e);else alert("No se pudo conectar con el servidor: "+serverIP)});serverIP="localhost";xhr.open("POST","http://"+serverIP+":3000");if(data.content=="getReporte")xhr.responseType="blob";xhr.setRequestHeader("Content-Type","application/json;charset=UTF-8");xhr.send(JSON.stringify(data))};$f.xhrPost2=function(data){return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;var xResponse=null;xhr.withCredentials=true;var serverIP=location.hostname;xhr.addEventListener("load",
function(){var state=this.readyState;var responseCode=xhr.status;console.log("request.onload called. readyState: "+state+"; status: "+responseCode);if(state==this.DONE&&responseCode==200){xResponse=this.responseText;resolve(JSON.parse(xResponse))}else reject(responseCode)});xhr.addEventListener("error",function(e){console.log("--Error en xhr");reject("No se pudo conectar con el servidor: "+serverIP)});xhr.open("POST","http://"+serverIP+":"+(parseInt(location.port)-1));xhr.setRequestHeader("Content-Type",
"application/json;charset=UTF-8");xhr.send(JSON.stringify(data))})};$f.consultar=function(nomb,parametros,exito,fracaso){var req={type:"query",content:nomb,params:parametros};$f.xhrPost(req,function(res){if(res!==null){var res_json=JSON.parse(res);if(res_json.tipo!=="error")exito(res_json.respuesta)}else if(fracaso==undefined)alert("Hubo un error: NULL");else fracaso()})};$f.openWindowIn=function(hash,callback_){var pri_principal_=$.ERPPrincipal.children[1];var hashAr=JSON.parse(decodeURIComponent(hash));
if(hashAr.length>0)for(var i=0;i<hashAr.length;i++){var actHashArItem=hashAr[i];var winPath=actHashArItem.url;var winTarget=actHashArItem.target;var winParams=actHashArItem.params;if(winTarget=="modal"){var wmodal=$f.instanciar({tag:"jswindowmodal"});var wmodalInner=$f.instanciar({tag:winPath,minHeight:"90%"});if(winParams!==undefined)wmodalInner.assignProps=JSON.parse(decodeURIComponent(winParams));wmodal.show(wmodalInner)}else if(winTarget=="priTabs"){var newWindow=$f.instanciar({tag:winPath});
pri_principal_.children[0].jscprinc.addin(newWindow)}else if(winTarget==undefined){var newWindow=$f.instanciar({tag:winPath,innerId:"jscprinc"});pri_principal_.emptyChildren();pri_principal_.addChild_r(newWindow)}}};$f.openWindowIn_=function(hash,callback_){var accion="normal";var pri_principal_=$.ERPPrincipal.pri_principal;var hashAr=hash.split("|");if(hashAr.length>1){var winPath=hashAr[0];var winTarget=hashAr[1];var winParams=hashAr[2];if(winTarget=="modal"){var wmodal=$f.instanciar({tag:"jswindowmodal"});
var wmodalInner=$f.instanciar({tag:winPath,minHeight:"90%"});if(winParams!==undefined)wmodalInner.assignProps=JSON.parse(decodeURIComponent(winParams));wmodal.show(wmodalInner);accion="none"}else if(winTarget=="priTabs"){var newWindow=$f.instanciar({tag:winPath});pri_principal_.jscprinc.addin(newWindow)}}return accion};$f.getperiodoactivo=function(){var periodo={cod:"20",nom:"2016-I",anio:"2016",semestre:"1"};return periodo};$f.getUniversity=function(){var university={nom:"Universidad Peruana del Centro"};
return university};$f.evalrequired=function(){var passed=true;for(var i=0;i<arguments.length-1;i++){var actObj=arguments[i];if(actObj.value!==undefined)if(actObj.value.toString().trim()===""){alert('Elemento "'+actObj.label+'" vac\u00edo');actObj.dom.focus();passed=false;break;return false}}if(passed==true)arguments[arguments.length-1]()};$f.generarForm=function(json,target){probando=$f.instanciar({tag:"div",position:"absolute",width:"100%",backgroundColor:"white",textContent:"asdfasdf"});target.addChild_r($f.instanciar($f.getObj(json)))};
$f.getObj=function(json){var returned={};if(json.length<2)returned={tag:"div",children:[]};else;var typAr={"group":"jsgroupbox","string":"jsinputh","string-password":"jsinputh","string-hidden":"jsinputh","string-date":"jsinputh","date":"jsinputh","button":"jsbutton","button-submit":"jsbutton","titlebar":"jstitlebar","boolean":"jsinputcheck"};for(var i=0;i<json.length;i++){var actRow=json[i];var actRowContainer={tag:"div",children:[]};if(json.length<2)actRowContainer={tag:"div",children:[]};for(var k in actRow){var actObj=
actRow[k];var typ=actObj.typ;var jsonObj={tag:typAr[typ]};if(typAr[typ]=="jstitlebar"){jsonObj.text=actObj.sName;jsonObj.innerId=k}if(typAr[typ]=="jsgroupbox"){jsonObj.jstitle=actObj.sName;jsonObj.innerId=k}if(typAr[typ]=="jsinputcheck"){jsonObj.label=actObj.sName;jsonObj.innerId=k;jsonObj.inputProps={};jsonObj.inputProps.value=actObj.val;jsonObj.inputProps.checked=actObj.val;jsonObj.binded=actObj;jsonObj.inputProps.events=[["change",function(){this.value=this.dom.checked;console.log("--",this.parent.binded.sName);
this.parent.binded.val=this.dom.value;console.log("--",this.parent.binded.val)},false]]}if(typAr[typ]=="jsinputh"){jsonObj.label=actObj.sName;jsonObj.inputProps={};jsonObj.inputProps.value=actObj.val;if(actObj.req!==undefined)jsonObj.inputProps.required=true;if(typ=="string-hidden"){jsonObj.display="none";jsonObj.inputProps.type="hidden"}if(typ=="string-date")jsonObj.inputProps.type="date";jsonObj.binded=actObj;jsonObj.inputProps.events=[["change",function(){console.log("--",this.parent.binded.sName);
this.parent.binded.val=this.dom.value},false]]}if(typAr[typ]=="jsbutton"){jsonObj.text=actObj.sName;if(typ=="button-submit")jsonObj.jstype="submit";if(actObj.subAction!==undefined){if(get_type(actObj.subAction.params)==1&&actObj.subAction.params[0]=="middleware"){jsonObj.action=actObj.action;jsonObj.subAction=actObj.subAction;jsonObj.actionAft=actObj.actionAft;jsonObj.parser=actObj.subAction.params[2];console.log(actObj.subAction.params)}jsonObj.events=[["click",function(e){var this_=this;var func=
function(){alert(this_.action);if(this_.action=="submit"){var req=this_.subAction;req.params=$f[this_.parser](json);console.log(this_.subAction);$f.xhrPost(req,function(res){var resJson=JSON.parse(res);if(resJson.cod==0){console.log(resJson);alert(resJson.mess);$f[this_.actionAft](json,resJson)}else if(resJson.cod>0)alert(resJson.mess);else{alert("Error Fatal");console.log("Hubo un error: NULL")}})}else if(this_.action=="openModal")alert("ACCION DE OPENMODAL")};if(this_.jstype=="submit"){var formulario=
this_.getParentBy("amark","form");formulario.enviar=func;formulario.dom.submit()}else func()},false]]}}if(actObj.alias!==undefined)jsonObj.innerId=actObj.alias;console.log("--",actObj);console.log("--",actObj.val);if(get_type(actObj.val)==1){var actObjChil=actObj.val;if(typAr[typ]=="jsgroupbox"){jsonObj.jscontent=[];jsonObj.jscontent.push($f.getObj(actObjChil))}else{jsonObj.children=[];jsonObj.children.push($f.getObj(actObjChil))}}else if(get_type(actObj.val)==undefined);actRowContainer.children.push(jsonObj)}returned.children.push(actRowContainer)}return returned};
$f.parseLoginForm=function(json){var returned={nickname:json[0].login.val[0].nickname.val,password:json[0].login.val[0].password.val};return returned};$f.parseEditUsuario=function(json){var returned={usuario:{id:json[0].usuario.val[0].id.val,nickname:json[0].usuario.val[0].nickname.val,password:json[0].usuario.val[0].password.val,activo:json[0].usuario.val[0].activo.val},persona:{nombres:json[0].persona.val[0].nombres.val,apellidos:json[0].persona.val[0].apellidos.val,fnacimiento:json[0].persona.val[0].fnacimiento.val}};
return returned};$f.parseLoginFormAft=function(json,resp){localStorage["actual_user"]=resp.nickname;alert("Esto es after");window.location="http://localhost:3000"};$f.parseEditUsuarioAft=function(json,resp){if(resp.cod==0)alert("Datos Guardados Correctamente");else alert('Hubo un error: "'+resp.mess+'"')}});
